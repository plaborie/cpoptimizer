% SP 2005/07/20 changed the bibliography to numerical
% SP 2005/06/24 changes needed for chapters with author names and a
%               bibliography
% SP 2005/06/09 copied from CMS.sty
% SP 2004/12/17 copied from MISE.sty
% identification
\def\filedate{2005/07/20} % to be published
\def\fileversion{0.3}
\ProvidesPackage{FAI}[\filedate \space v\fileversion
    \space FAI layout parameters for memoir.cls]

% options
\DeclareOption{debug}{\debugtrue}
\newif\ifdebug\debugfalse
\ProcessOptions
% use Times Roman
\RequirePackage{times}
% use the natbib package with the bibliography as a section
\RequirePackage[sectionbib]{natbib}
% use numerical style
\bibpunct{[}{]}{,}{n}{}{,}

% SP 20050624
% rewritten to accommodate author names
% pagestyle
\makepagestyle{elsbook}
\makeevenhead{elsbook}{{\thepage}}{\textit{\leftmark}}{}
\makeoddhead{elsbook}{}{\textit{\rightmark}}{{\thepage}}
\makepsmarks{elsbook}%
   {\let\@mkboth\markboth
    \def\chaptermark##1{\markboth
      {\ifnum\c@chapter=0\relax\else\thechapter. \fi{##1}}%
      {\ifnum\c@chapter=0\relax\else\thechapter. \fi{##1}}}%
    \let\sectionmark\@gobble
    \let\sectionmarknonum\@gobble
    \def\authormark##1{\markright{{##1}}}}

% SP 20040413
% part pages have empty page style
\aliaspagestyle{part}{empty}

% SP 20050624
% metadata
\def\@volumetitle{Volume title}
\def\volumetitle#1{\gdef\@volumetitle{#1}\ignorespaces}
\def\@editors{The editors}
\def\editors#1{\gdef\@editors{#1}\ignorespaces}
\let\@runheadsize\relax
\newcount\@pubyear
\@pubyear=\number\year
\def\pubyear#1{\global\@pubyear#1}
\def\company#1{\def\@company{#1}}
\def\@company{Elsevier}

% SP 20050624
% chapter title page style
\def\@nonuple#1#2#3#4#5#6#7#8#9{\vtop{%
  \hbox to \textwidth{\strut \rlap{#1} \hfil {#2} \hfil \llap{#3}}%
  \hbox to \textwidth{\strut \rlap{#4} \hfil {#5} \hfil \llap{#6}}%
  \hbox to \textwidth{\strut \rlap{#7} \hfil {#8} \hfil \llap{#9}}}}
\def\@copyright{$\copyright$ \the\@pubyear\ \@company\ All rights reserved}
\def\@logohead{\small
  \vtop to \z@{%
    \vbox to \z@{%
      \@nonuple
        {\@volumetitle}{}{\@runheadsize\thepage}%
        {\@editors}{}{}%
        {\@copyright}{}{}%
      \vss
    }%
    \vss
  }%
}%

\def\ps@chaptertitle{%
  \def\@oddhead{\@logohead}%
  \let\@evenhead\@oddhead
  \def\@oddfoot{}%
  \def\@evenfoot{}}

% SP 20050624
% chapter title and authors
% \chaptertitleauthors[toc-title]{title}{authors}
% Use \chaptermark and \authormark to provide alternative text
% for the running heads
\newcommand{\chaptertitleauthors}[3][\@empty]%
  {\chapter[#1]{#2}
   \addcontentsline{toc}{chapterauthor}{\protect\numberline{}#3}%
   {\chapterauthorfont#3\par}%
   \authormark{#3}%
   \vspace{\afterauthorskip}%
   \thispagestyle{chaptertitle}%
   \@afterheading}
\newcommand{\chapterauthorfont}{\normalfont\huge\bfseries}
\newlength\afterauthorskip
\setlength{\afterauthorskip}{\the\afterchapskip}
\setlength{\afterchapskip}{\the\midchapskip}

\def\l@chapterauthor#1#2{%
  \ifnum \@nameuse {c@tocdepth} > 0\relax
  \vskip \@nameuse {cftbeforesectionskip}
  {\leftskip \@nameuse {cftsectionindent}\relax 
    \rightskip \@tocrmarg 
    \parindent \@nameuse {cftsectionindent}\relax 
    \@afterindenttrue 
    \interlinepenalty \@M 
    \leavevmode 
    \@tempdima \@nameuse {cftsectionnumwidth}\relax 
    \expandafter \let \expandafter \@cftbsnum 
      \csname cftsectionpresnum\endcsname 
    \expandafter \let \expandafter \@cftasnum 
      \csname cftsectionaftersnum\endcsname 
    \expandafter \let \expandafter \@cftasnumb 
      \csname cftsectionaftersnumb\endcsname 
    \advance \leftskip \@tempdima \null \nobreak \hskip -\leftskip 
    {\@nameuse {cftchapterauthorfont}#1}% 
    \par}
  \fi}
\def\cftchapterauthorfont{\normalfont\bfseries}

% SP 20050624
% bibliographic references
% remove vertical spacing between bibliographic references
\setlength{\bibsep}{0pt}

% This does not work well with natbib; use natbib's option sectionbib
% % Create a chapter bibliography as an unnumbered section
% % Provide separate hooks for this environment
% \newenvironment{thechapterbibliography}[1]%
%   {\chapbibsection\begin{bibitemlist}{#1}}%
%   {\end{bibitemlist}\postchapbibhook}
% \newcommand{\prechapbibhook}{}
% \newcommand{\postchapbibhook}{}
% \newcommand{\chapbibsection}{\section*{\chapbibname}\prechapbibhook}
% \let\chapbibname\bibname

% Let natbib's sectionbib option use \section*
\renewcommand{\@memb@bsec}{\section*{\bibname}\prebibhook}

% page layout
% SP 20040917
% increase the stock size to letter paper
% \setstocksize{25cm}{16.5cm}
\setstocksize{11in}{8.5in}
\settrimmedsize{24cm}{16.5cm}{*}
\settrims{1.25cm}{1.5cm}
\settypeblocksize{46pc}{30pc}{*}
\setlrmargins{*}{*}{1.618}
\setulmargins{4pc}{*}{*}
\setheadfoot{15pt}{24pt}
\setheaderspaces{*}{\onelineskip}{*}
\setmarginnotes{1pc}{3pc}{\onelineskip}
\checkandfixthelayout
% \ifdebug\typeoutlayout\fi

% resulting layout:
% ******************************************************
% Stock height and width: 794.96999pt by 614.295pt
% Top and edge trims: 35.56593pt and 42.67912pt
% Page height and width: 682.86613pt by 469.47046pt
% Text height and width: 562.0pt by 360.0pt
% Spine and edge margins: 41.82434pt and 67.64612pt
% Upper and lower margins: 48.0pt and 72.86613pt
% Headheight and headsep: 15.0pt and 12.0pt
% Footskip: 24.0pt
% Columnsep and columnseprule: 10.0pt and 0.0pt
% Marginparsep and marginparwidth: 12.0pt and 36.0pt
% ******************************************************

\maxsecnumdepth{subsection}
% \renewcommand{\thepart}{\arabic{part}}

% title page layout
\setlength\droptitle{4\onelineskip}
\renewcommand{\maketitlehooka}{\bgroup\parindent=0pt%
    \title{\@volumetitle}\author{\@editors}}
\pretitle{\Huge\bfseries}
\posttitle{\par}
\renewcommand{\maketitlehookb}{\vspace*{2\onelineskip}}
\preauthor{\LARGE}
\postauthor{\par}
\renewcommand{\maketitlehookc}%
   {\vspace*{2\onelineskip}%
    \putaddress}
\renewcommand{\maketitlehookd}%
   {\setcounter{page}{3}%
    \vspace{\fill}%
    {\Large Elsevier}%
    \egroup
    \thispagestyle{empty}%
    \cleardoublepage}
\newcommand{\address}[1]{\gdef\@address{#1}}
\newcommand{\@address}{}
\newcommand{\putaddress}{{\Large\itshape\@address\par}}
\date{}

\pagestyle{elsbook}

